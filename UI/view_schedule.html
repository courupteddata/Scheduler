<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">



  <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      var calendarEl = document.getElementById('calendar');
      var schedule_id = window.location.search.split("=")[1];

      var data =
      {
        "shifts":[
          {"id":"0", "start":"2019-05-06T10:00:00.756Z", "end":"2019-05-06T18:00:00.756Z", "label":"Amy"},
          {"id":"1", "start":"2019-05-07T10:00:00.756Z", "end":"2019-05-07T18:00:00.756Z", "label":"Emily"},
          {"id":"2", "start":"2019-05-08T10:00:00.756Z", "end":"2019-05-08T18:00:00.756Z", "label":"Frank"},
          {"id":"3", "start":"2019-05-09T10:00:00.756Z", "end":"2019-05-09T18:00:00.756Z", "label":"Karl"},
          {"id":"4", "start":"2019-05-10T10:00:00.756Z", "end":"2019-05-10T18:00:00.756Z", "label":"Beyonce"}
        ]
      };
      var events = [];
      data.shifts.forEach(function(shift) {
        events.push({
          title: shift.label,
          start: shift.start,
          end: shift.end,
          id: shift.id
        });
      });

      var calendar = new FullCalendar.Calendar(calendarEl, {
        plugins: ['dayGrid', 'interaction'],
        defaultView: 'dayGridMonth',
        editable: true,
        eventDrop: function(info) {
          if (!confirm("Are you sure you want to move this shift to " + info.event.start.toLocaleString() + "?")) {
            info.revert();
          } else {
            // send info.event.start and end to api
          }
        },
        eventClick: function(info) {
          $('#start_time')[0].value = info.event.start.toISOString().substring(0, 16);
          $('#end_time')[0].value = info.event.end.toISOString().substring(0, 16);
          $('#employee')[0].placeholder = info.event.title;
          $('#shift_id')[0].value = info.event.id;
          $('#submit')[0].setAttribute('onclick', 'submitEdit(this.form);');
          $('#delete')[0].removeAttribute('hidden');
          $('.modal-title')[0].innerHTML = 'Edit Shift'
          $('.modal').modal();
        },
        dateClick: function(info) {
          $('#start_time')[0].value = info.dateStr + "T07:00";
          $('#end_time')[0].value = info.dateStr + "T15:00";
          $('#employee')[0].placeholder = 'Employee';
          $('#shift_id')[0].value = null;
          $('#submit')[0].setAttribute('onclick', 'submitNew(this.form);');
          $('#delete')[0].setAttribute('hidden', '');
          $('.modal-title')[0].innerHTML = 'Add Shift'
          $('.modal').modal();
        },
        header: {
          left: 'prev,next today',
          center: 'title',
        },
        events: events
      });

      calendar.render();
    });
    </script>

    <script>
      function submitEdit(form) {
        for (var i=0, element; element = form.elements[i]; i++) {
          console.log(element.value);
        }
      };
    </script>
    <script>
      function submitNew(form) {
        $.ajax({
          url: 'http://127.0.0.1:5000/api/v1/shift',
          type: 'POST',
          contentType: 'application/json;charset=UTF-8',
          data: JSON.stringify({
            "start":form.elements[0].value,
            "end":form.elements[1].value,
            "location_id":,
            "entity_id":,
            }
          }),
          success: function( data ) {
            alert("Constraint submitted");
          }
        });
      };
    </script>
    <script>
      function deleteShift(form) {
        for (var i=0, element; element = form.elements[i]; i++) {
          console.log(element.value);
        }
      };
    </script>

  <title>View Schedule</title>
</head>
<body>
  <a href="index.html">Home</a>
  <div class="modal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Edit Shift</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form>
            <div class="form-group">
              <label for="start_time">Start:</label>
              <input type="datetime-local" class="form-control" id="start_time">
            </div>
            <div class="form-group">
              <label for="end_time">End:</label>
              <input type="datetime-local" class="form-control" id="end_time">
            </div>
            <div class="form-group">
              <label for="employee">Assigned Employee:</label>
              <input type="text" class="form-control" id="employee">
            </div>
            <input type="text" id="shift_id" hidden>
            <button type="button" class="btn btn-primary" data-dismiss="modal" id="submit">Submit changes</button>
            <button type="button" class="btn btn-danger" data-dismiss="modal" id="delete" onClick="deleteShift(this.form);">Delete Shift</button>
          </form>
        </div>
      </div>
    </div>
  </div>
  <div id='calendar' style="max-width: 900px; margin: 40px auto;"></div>
</body>
</html>
